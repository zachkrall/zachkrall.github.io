"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _toConsumableArray2 = require("babel-runtime/helpers/toConsumableArray");

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _extends2 = require("babel-runtime/helpers/extends");

var _extends3 = _interopRequireDefault(_extends2);

var _urlJoin = require("url-join");

var _urlJoin2 = _interopRequireDefault(_urlJoin);

var _RouteUtils = require("react-router/lib/RouteUtils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var debug = require("debug")("phenomic:plugin:react");

function flattenRoutes(routes) {
  var path = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "";

  debug("flattenRoutes");

  return routes.reduce(function (acc, route) {
    var nextRoute = (0, _extends3.default)({}, route, {
      path: (route.path || "").startsWith("/") ? route.path : route.path ? (0, _urlJoin2.default)(path, route.path) : path
    });
    if (route.childRoutes) {
      acc.push.apply(acc, (0, _toConsumableArray3.default)(flattenRoutes(nextRoute.childRoutes, nextRoute.path)));
    } else {
      acc.push(nextRoute);
    }
    return acc;
  }, []);
}

function getRoutes(app) {
  var routes = (0, _RouteUtils.createRouteFromReactElement)(app.routes);
  var flatRoutes = flattenRoutes(routes.childRoutes);
  debug(flatRoutes);
  return flatRoutes;
}

exports.default = getRoutes;