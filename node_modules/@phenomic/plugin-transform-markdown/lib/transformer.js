"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _keys = require("babel-runtime/core-js/object/keys");

var _keys2 = _interopRequireDefault(_keys);

var _extends2 = require("babel-runtime/helpers/extends");

var _extends3 = _interopRequireDefault(_extends2);

var _unified = require("unified");

var _unified2 = _interopRequireDefault(_unified);

var _remarkParse = require("remark-parse");

var _remarkParse2 = _interopRequireDefault(_remarkParse);

var _remarkToc = require("remark-toc");

var _remarkToc2 = _interopRequireDefault(_remarkToc);

var _remarkRehype = require("remark-rehype");

var _remarkRehype2 = _interopRequireDefault(_remarkRehype);

var _rehypeRaw = require("rehype-raw");

var _rehypeRaw2 = _interopRequireDefault(_rehypeRaw);

var _rehypeSlug = require("rehype-slug");

var _rehypeSlug2 = _interopRequireDefault(_rehypeSlug);

var _rehypeAutolinkHeadings = require("rehype-autolink-headings");

var _rehypeAutolinkHeadings2 = _interopRequireDefault(_rehypeAutolinkHeadings);

var _rehypeHighlight = require("rehype-highlight");

var _rehypeHighlight2 = _interopRequireDefault(_rehypeHighlight);

var _rehypeStringify = require("rehype-stringify");

var _rehypeStringify2 = _interopRequireDefault(_rehypeStringify);

var _rehypeReact = require("rehype-react");

var _rehypeReact2 = _interopRequireDefault(_rehypeReact);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// here we optimize structure just a little to have to smallest json possible
var createElement = function createElement(component, props, children) {
  return (0, _extends3.default)({
    t: component
  }, props && (0, _keys2.default)(props).length ? { p: props } : {}, children ? { c: children } : {});
};

exports.default = function (config, body) {
  var processor = (0, _unified2.default)().use(_remarkParse2.default).use(_remarkToc2.default).use(_remarkRehype2.default, { allowDangerousHTML: true }).use(_rehypeRaw2.default).use(_rehypeSlug2.default).use(_rehypeAutolinkHeadings2.default).use(_rehypeHighlight2.default);

  var useReact = config && config.plugins && config.plugins.find(function (p) {
    return p.name === "@phenomic/plugin-renderer-react";
  });

  if (!useReact) {
    processor.use(_rehypeStringify2.default);
  } else {
    processor.use(_rehypeReact2.default, { createElement: createElement });
  }

  return processor.processSync(body);
};